language: python
python:
  - "3.6"
  - "3.7"
  - "2.7"

os: linux
dist: xenial
sudo: required

branches:
  only:
  - master

# command to install dependencies
install:
  - pip install -r requirements.txt
  # Enable running MPI tests
  - sudo apt-get install -y -q openmpi-bin libopenmpi-dev
  - pip install mpi4py

script:
  - pytest -s --cov=jobqueue_features

# command to run tests
jobs:
  include:
    - stage: style
      # Use black for style checking (Python3 only)
      install:
        - if [[ "$TRAVIS_PYTHON_VERSION" =~ ^[3-9].+ ]]; then
            echo installing black for Python $TRAVIS_PYTHON_VERSION;
            pip install black;
          else
            echo Python is $TRAVIS_PYTHON_VERSION so not using black;
          fi
      script: 
        - if [[ "$TRAVIS_PYTHON_VERSION" =~ ^[3-9].+ ]]; then
            black --check .;
          else
            echo Python is $TRAVIS_PYTHON_VERSION so not using black;
          fi
    - stage: spelling
      # Use codespell for spell checking
      install:
        pip install codespell
      script: codespell --quiet-level=2
